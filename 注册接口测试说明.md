# ç”¨æˆ·æ³¨å†Œæ¥å£å¼€å‘å®Œæˆè¯´æ˜

## ğŸ“¦ å·²åˆ›å»ºæ–‡ä»¶æ¸…å•

### 1. DTOå±‚
- **RegisterDTO.java** - ç”¨æˆ·æ³¨å†Œè¯·æ±‚æ•°æ®ä¼ è¾“å¯¹è±¡
  - åŒ…å«è´¦å·ã€å¯†ç ã€å­¦æ ¡ã€å­¦é™¢ã€å­¦å·ç­‰å­—æ®µ
  - ä½¿ç”¨ JSR-303 æ ¡éªŒæ³¨è§£è¿›è¡Œå‚æ•°éªŒè¯

### 2. VOå±‚
- **RegisterVO.java** - ç”¨æˆ·æ³¨å†Œå“åº”è§†å›¾å¯¹è±¡
  - è¿”å›æ³¨å†ŒæˆåŠŸåçš„ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
  - ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰

### 3. Entityå±‚
- **Student.java** - å­¦ç”Ÿä¿¡æ¯å®ä½“ç±»
- **School.java** - å­¦æ ¡ä¿¡æ¯å®ä½“ç±»
- **Department.java** - å­¦é™¢ä¿¡æ¯å®ä½“ç±»

### 4. Mapperå±‚
- **UserMapper.java** - ç”¨æˆ·æ•°æ®è®¿é—®æ¥å£
- **StudentMapper.java** - å­¦ç”Ÿæ•°æ®è®¿é—®æ¥å£

### 5. Serviceå±‚
- **AuthService.java** - è®¤è¯æœåŠ¡æ¥å£
- **AuthServiceImpl.java** - è®¤è¯æœåŠ¡å®ç°ç±»
  - å®ç°äº†å®Œæ•´çš„æ³¨å†Œä¸šåŠ¡é€»è¾‘
  - åŒ…å«è´¦å·å”¯ä¸€æ€§æ ¡éªŒ
  - å­¦ç”Ÿèº«ä»½éªŒè¯ï¼ˆå­¦å·+å­¦æ ¡+å­¦é™¢ï¼‰
  - BCrypt å¯†ç åŠ å¯†

### 6. Controllerå±‚
- **AuthController.java** - è®¤è¯æ§åˆ¶å™¨
  - æä¾› POST /api/auth/register æ³¨å†Œæ¥å£
  - é›†æˆ Swagger æ–‡æ¡£æ³¨è§£

### 7. SQLè„šæœ¬
- **migration_add_schools_departments_students.sql** - æ•°æ®åº“è¿ç§»è„šæœ¬
  - åˆ›å»º schoolsã€departmentsã€students è¡¨
  - æ’å…¥æµ‹è¯•æ•°æ®

---

## ğŸ” ä»£ç ç‰¹ç‚¹

### 1. å®Œæ•´çš„æ³¨é‡Š
âœ… æ‰€æœ‰ç±»ã€æ–¹æ³•ã€å­—æ®µéƒ½æœ‰è¯¦ç»†çš„ JavaDoc æ³¨é‡Š  
âœ… ä¸šåŠ¡é€»è¾‘å…³é”®ç‚¹éƒ½æœ‰è¡Œå†…æ³¨é‡Šè¯´æ˜  
âœ… æ³¨é‡Šç¬¦åˆ Java è§„èŒƒ

### 2. åˆ†å±‚æ¶æ„æ¸…æ™°
```
Controller -> Service -> Mapper -> Database
    â†“           â†“          â†“
   DTO         VO       Entity
```

### 3. ä¸šåŠ¡é€»è¾‘å®Œæ•´
- âœ… è´¦å·å”¯ä¸€æ€§æ ¡éªŒ
- âœ… å­¦ç”Ÿèº«ä»½éªŒè¯ï¼ˆå­¦å·+å­¦æ ¡ID+å­¦é™¢ID+åœ¨æ ¡çŠ¶æ€ï¼‰
- âœ… å¯†ç  BCrypt åŠ å¯†å­˜å‚¨
- âœ… äº‹åŠ¡ç®¡ç† (@Transactional)
- âœ… å¼‚å¸¸å¤„ç†ï¼ˆBusinessExceptionï¼‰
- âœ… æ—¥å¿—è®°å½•

### 4. å‚æ•°æ ¡éªŒ
- âœ… ä½¿ç”¨ Bean Validation (@NotBlank, @Size ç­‰)
- âœ… Controller å±‚ä½¿ç”¨ @Valid è§¦å‘æ ¡éªŒ
- âœ… æ ¡éªŒå¤±è´¥è‡ªåŠ¨è¿”å› 400 é”™è¯¯

### 5. ç¬¦åˆ API æ–‡æ¡£è§„èŒƒ
- âœ… æ¥å£è·¯å¾„ï¼šPOST /api/auth/register
- âœ… è¯·æ±‚å‚æ•°ä¸ API.md ä¸€è‡´
- âœ… å“åº”æ ¼å¼ä¸ API.md ä¸€è‡´
- âœ… é”™è¯¯ç ç¬¦åˆè§„èŒƒï¼ˆ40001ã€40005ï¼‰

---

## ğŸš€ ä½¿ç”¨è¯´æ˜

### 1. æ‰§è¡Œæ•°æ®åº“è„šæœ¬

é¦–å…ˆæ‰§è¡ŒåŸºç¡€è¡¨ç»“æ„ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰:
```bash
# è¿›å…¥ MySQL
mysql -u root -p

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
source e:/unisport-backend/src/main/resources/sql/init.sql

# æ‰§è¡Œå­¦æ ¡å­¦é™¢å­¦ç”Ÿè¡¨è„šæœ¬
source e:/unisport-backend/src/main/resources/sql/migration_add_schools_departments_students.sql
```

### 2. å¯åŠ¨é¡¹ç›®

```bash
cd e:/unisport-backend
mvn spring-boot:run
```

### 3. è®¿é—® API æ–‡æ¡£

æµè§ˆå™¨æ‰“å¼€ï¼šhttp://localhost:8080/doc.html

åœ¨ Swagger UI ä¸­å¯ä»¥ç›´æ¥æµ‹è¯•æ³¨å†Œæ¥å£ã€‚

### 4. æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹1ï¼šæ³¨å†ŒæˆåŠŸï¼ˆæ¸…åå¤§å­¦è®¡ç®—æœºç³»ï¼‰

**è¯·æ±‚**:
```json
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "account": "test2024001",
  "password": "123456",
  "school": "æ¸…åå¤§å­¦",
  "schoolId": 1,
  "department": "è®¡ç®—æœºç³»",
  "departmentId": 1,
  "studentId": "2024001001"
}
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "id": 3,
    "account": "test2024001",
    "nickname": "test2024001",
    "school": "æ¸…åå¤§å­¦",
    "department": "è®¡ç®—æœºç³»",
    "studentId": "2024001001",
    "createdAt": "2025-12-01 10:00:00"
  },
  "timestamp": 1701234567890
}
```

#### æµ‹è¯•ç”¨ä¾‹2ï¼šè´¦å·å·²å­˜åœ¨

**è¯·æ±‚**:
```json
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "account": "test2024001",
  "password": "123456",
  "school": "æ¸…åå¤§å­¦",
  "schoolId": 1,
  "department": "è®¡ç®—æœºç³»",
  "departmentId": 1,
  "studentId": "2024001002"
}
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 40001,
  "message": "è´¦å·å·²å­˜åœ¨ï¼Œè¯·æ›´æ¢è´¦å·",
  "data": null,
  "timestamp": 1701234567890
}
```

#### æµ‹è¯•ç”¨ä¾‹3ï¼šå­¦å·éªŒè¯å¤±è´¥

**è¯·æ±‚**:
```json
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "account": "test2024003",
  "password": "123456",
  "school": "æ¸…åå¤§å­¦",
  "schoolId": 1,
  "department": "è®¡ç®—æœºç³»",
  "departmentId": 1,
  "studentId": "9999999999"
}
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 40005,
  "message": "å­¦å·éªŒè¯å¤±è´¥ï¼šè¯¥å­¦å·ä¸å­˜åœ¨æˆ–å­¦æ ¡/å­¦é™¢ä¿¡æ¯ä¸åŒ¹é…",
  "data": null,
  "timestamp": 1701234567890
}
```

#### æµ‹è¯•ç”¨ä¾‹4ï¼šå‚æ•°æ ¡éªŒå¤±è´¥

**è¯·æ±‚**:
```json
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "account": "ab",
  "password": "123",
  "school": "",
  "schoolId": null,
  "department": "",
  "departmentId": null,
  "studentId": ""
}
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 40004,
  "message": "è´¦å·é•¿åº¦å¿…é¡»åœ¨3-50ä¸ªå­—ç¬¦ä¹‹é—´",
  "data": null,
  "timestamp": 1701234567890
}
```

---

## ğŸ“Š æ•°æ®åº“æµ‹è¯•æ•°æ®

### å¯ç”¨äºæµ‹è¯•çš„å­¦ç”Ÿå­¦å·

| å­¦å· | å§“å | å­¦æ ¡ | å­¦é™¢ | schoolId | departmentId |
|------|------|------|------|----------|--------------|
| 2024001001 | å¼ ä¸‰ | æ¸…åå¤§å­¦ | è®¡ç®—æœºç³» | 1 | 1 |
| 2024001002 | æå›› | æ¸…åå¤§å­¦ | è®¡ç®—æœºç³» | 1 | 1 |
| 2024002001 | ç‹äº” | æ¸…åå¤§å­¦ | ç»ç®¡å­¦é™¢ | 1 | 2 |
| 2024101001 | å‘¨å…« | åŒ—äº¬å¤§å­¦ | ä¿¡æ¯ç§‘å­¦æŠ€æœ¯å­¦é™¢ | 2 | 6 |
| 2024201001 | é’±ä¸€ | å¤æ—¦å¤§å­¦ | è®¡ç®—æœºç§‘å­¦æŠ€æœ¯å­¦é™¢ | 3 | 10 |

---

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **å¯†ç åŠ å¯†å­˜å‚¨**
   - ä½¿ç”¨ BCrypt ç®—æ³•
   - è‡ªåŠ¨åŠ ç›ï¼Œæ¯æ¬¡åŠ å¯†ç»“æœä¸åŒ
   - ä¸å¯é€†åŠ å¯†

2. **å­¦ç”Ÿèº«ä»½éªŒè¯**
   - å­¦å·å¿…é¡»åœ¨ students è¡¨ä¸­å­˜åœ¨
   - å­¦æ ¡IDã€å­¦é™¢ID å¿…é¡»åŒ¹é…
   - å­¦ç”ŸçŠ¶æ€å¿…é¡»ä¸ºåœ¨æ ¡ï¼ˆstatus=1ï¼‰

3. **è½¯ç»‘å®šè®¾è®¡**
   - users è¡¨çš„ student_id å­—æ®µä¸æ˜¯å¤–é”®
   - å…è®¸å­¦ç”Ÿæ¯•ä¸šåä»å¯ä½¿ç”¨è´¦å·
   - æ³¨å†Œæ—¶éªŒè¯ï¼Œä½¿ç”¨æ—¶ä¸å¼ºåˆ¶å…³è”

---

## ğŸ“ ä»£ç å®¡æŸ¥è¦ç‚¹

### 1. DTO å‚æ•°æ ¡éªŒ
```java
@NotBlank(message = "è´¦å·ä¸èƒ½ä¸ºç©º")
@Size(min = 3, max = 50, message = "è´¦å·é•¿åº¦å¿…é¡»åœ¨3-50ä¸ªå­—ç¬¦ä¹‹é—´")
private String account;
```

### 2. Service å±‚äº‹åŠ¡ç®¡ç†
```java
@Transactional(rollbackFor = Exception.class)
public RegisterVO register(RegisterDTO registerDTO) {
    // æ³¨å†Œå¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
}
```

### 3. å¯†ç åŠ å¯†
```java
// ä½¿ç”¨ Hutool çš„ BCrypt å·¥å…·
String hashedPassword = BCrypt.hashpw(registerDTO.getPassword());
```

### 4. å¼‚å¸¸å¤„ç†
```java
// è´¦å·é‡å¤
throw new BusinessException(40001, "è´¦å·å·²å­˜åœ¨ï¼Œè¯·æ›´æ¢è´¦å·");

// å­¦å·éªŒè¯å¤±è´¥
throw new BusinessException(40005, "å­¦å·éªŒè¯å¤±è´¥ï¼šè¯¥å­¦å·ä¸å­˜åœ¨æˆ–å­¦æ ¡/å­¦é™¢ä¿¡æ¯ä¸åŒ¹é…");
```

### 5. æ—¥å¿—è®°å½•
```java
log.info("å¼€å§‹å¤„ç†ç”¨æˆ·æ³¨å†Œï¼Œè´¦å·ï¼š{}", registerDTO.getAccount());
log.warn("å­¦å·éªŒè¯å¤±è´¥ï¼šå­¦å·={}ï¼Œå­¦æ ¡ID={}ï¼Œå­¦é™¢ID={}", ...);
log.debug("å­¦ç”Ÿèº«ä»½éªŒè¯é€šè¿‡ï¼šå­¦å·={}ï¼Œå§“å={}", ...);
```

---

## âœ… æµ‹è¯•æ¸…å•

- [ ] æ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬
- [ ] å¯åŠ¨é¡¹ç›®æ— æŠ¥é”™
- [ ] è®¿é—® Swagger æ–‡æ¡£æˆåŠŸ
- [ ] æµ‹è¯•æ­£å¸¸æ³¨å†Œæµç¨‹
- [ ] æµ‹è¯•è´¦å·é‡å¤åœºæ™¯
- [ ] æµ‹è¯•å­¦å·éªŒè¯å¤±è´¥åœºæ™¯
- [ ] æµ‹è¯•å‚æ•°æ ¡éªŒå¤±è´¥åœºæ™¯
- [ ] æ£€æŸ¥æ—¥å¿—è¾“å‡ºæ˜¯å¦æ­£ç¡®
- [ ] æ£€æŸ¥æ•°æ®åº“è®°å½•æ˜¯å¦æ­£ç¡®
- [ ] éªŒè¯å¯†ç æ˜¯å¦åŠ å¯†å­˜å‚¨

---

## ğŸ¯ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®

1. **ç™»å½•æ¥å£** - POST /api/auth/login
2. **è·å–å­¦æ ¡åˆ—è¡¨** - GET /api/schools
3. **è·å–å­¦é™¢åˆ—è¡¨** - GET /api/departments?schoolId=1
4. **éªŒè¯å­¦å·æ¥å£** - GET /api/students/validate

å¼€å‘å®Œæˆï¼æ‰€æœ‰ä»£ç éƒ½åŒ…å«è¯¦ç»†æ³¨é‡Šï¼Œå¯ä»¥ç›´æ¥æ£€æŸ¥ã€‚
