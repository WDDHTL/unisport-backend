# å‘å¸ƒå¸–å­æ¥å£å¼€å‘å®Œæˆ

> **å¼€å‘æ—¶é—´**: 2025-12-10  
> **æ¥å£åœ°å€**: `POST /api/posts`  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ å¼€å‘å†…å®¹

### 1. å®ä½“ç±»è®¾è®¡

å·²å­˜åœ¨çš„ `Post` å®ä½“ç±» (ä½äº `entity/Post.java`):

```java
@Data
@TableName("posts")
public class Post implements Serializable {
    @TableId(value = "id", type = IdType.AUTO)
    private Long id;              // å¸–å­ID
    private Long userId;          // å‘å¸ƒç”¨æˆ·ID
    private Integer categoryId;   // è¿åŠ¨åˆ†ç±»ID
    private String content;       // å¸–å­å†…å®¹
    private String images;        // å›¾ç‰‡URLæ•°ç»„ï¼ˆJSONæ ¼å¼ï¼‰
    private Integer likesCount;   // ç‚¹èµæ•°
    private Integer commentsCount; // è¯„è®ºæ•°
    private Integer status;       // çŠ¶æ€ï¼š1-æ­£å¸¸, 0-åˆ é™¤
    
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createdAt;
    
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updatedAt;
    
    @TableLogic
    private Integer deleted;      // é€»è¾‘åˆ é™¤
}
```

### 2. æ–°å¢æ–‡ä»¶

#### DTOå±‚
- âœ… `CreatePostDTO.java` - å‘å¸ƒå¸–å­è¯·æ±‚DTO
  - categoryCode: è¿åŠ¨åˆ†ç±»ä»£ç ï¼ˆå¿…å¡«ï¼Œå¦‚ï¼šfootballï¼‰
  - content: å¸–å­å†…å®¹ï¼ˆå¿…å¡«ï¼Œ1-5000å­—ç¬¦ï¼‰
  - images: å›¾ç‰‡URLåˆ—è¡¨ï¼ˆå¯é€‰ï¼Œæœ€å¤š9å¼ ï¼‰

#### Mapperå±‚
- âœ… `PostMapper.java` - å¸–å­æ•°æ®è®¿é—®å±‚æ¥å£

#### Serviceå±‚
- âœ… `PostService.java` - å¸–å­æœåŠ¡æ¥å£
- âœ… `PostServiceImpl.java` - å¸–å­æœåŠ¡å®ç°ç±»

#### Controllerå±‚
- âœ… `PostController.java` - å¸–å­æ§åˆ¶å™¨

---

## ğŸ”§ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

### å‘å¸ƒå¸–å­æµç¨‹

1. **ç”¨æˆ·è®¤è¯** - ä»JWT Tokenè·å–å½“å‰ç™»å½•ç”¨æˆ·IDï¼ˆé€šè¿‡ThreadLocalï¼‰
2. **åˆ†ç±»éªŒè¯** - éªŒè¯è¿åŠ¨åˆ†ç±»ä»£ç æ˜¯å¦å­˜åœ¨ä¸”å·²å¯ç”¨
3. **é¢‘ç‡é™åˆ¶** - æ£€æŸ¥1åˆ†é’Ÿå†…æ˜¯å¦å·²å‘å¸ƒ3æ¡å¸–å­
4. **å›¾ç‰‡å¤„ç†** - å°†å›¾ç‰‡URLåˆ—è¡¨è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²å­˜å‚¨
5. **åˆ›å»ºå¸–å­** - ä¿å­˜å¸–å­è®°å½•ï¼Œåˆå§‹åŒ–ç‚¹èµæ•°å’Œè¯„è®ºæ•°ä¸º0
6. **è¿”å›ç»“æœ** - è¿”å›å®Œæ•´çš„å¸–å­å®ä½“å¯¹è±¡

### ä¸šåŠ¡è§„åˆ™

âœ… **å¿…é¡»ç™»å½•** - éœ€è¦JWT Tokenè®¤è¯  
âœ… **åˆ†ç±»æ ¡éªŒ** - categoryCodeå¿…é¡»åœ¨categoriesè¡¨ä¸­å­˜åœ¨  
âœ… **å†…å®¹é™åˆ¶** - 1-5000ä¸ªå­—ç¬¦  
âœ… **å›¾ç‰‡é™åˆ¶** - æœ€å¤š9å¼ å›¾ç‰‡  
âœ… **é¢‘ç‡é™åˆ¶** - 1åˆ†é’Ÿå†…æœ€å¤šå‘å¸ƒ3æ¡å¸–å­  
âœ… **äº‹åŠ¡ä¿è¯** - ä½¿ç”¨@Transactionalç¡®ä¿æ•°æ®ä¸€è‡´æ€§

---

## ğŸ”Œ æ¥å£æ–‡æ¡£

### è¯·æ±‚ç¤ºä¾‹

**URL**: `POST http://localhost:8080/api/posts`

**Headers**:
```
Content-Type: application/json
Authorization: Bearer <JWT_TOKEN>
```

**Request Body**:
```json
{
  "categoryCode": "football",
  "content": "ä»Šå¤©çš„æ¯”èµ›å¤ªç²¾å½©äº†ï¼",
  "images": [
    "https://example.com/upload/123.jpg",
    "https://example.com/upload/456.jpg"
  ]
}
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": 1,
    "userId": 2,
    "categoryId": 1,
    "content": "ä»Šå¤©çš„æ¯”èµ›å¤ªç²¾å½©äº†ï¼",
    "images": "[\"https://example.com/upload/123.jpg\",\"https://example.com/upload/456.jpg\"]",
    "likesCount": 0,
    "commentsCount": 0,
    "status": 1,
    "createdAt": "2025-12-10T22:30:00",
    "updatedAt": "2025-12-10T22:30:00",
    "deleted": 0
  },
  "timestamp": 1701234567890
}
```

### é”™è¯¯å“åº”

| é”™è¯¯ç  | è¯´æ˜ | åœºæ™¯ |
|--------|------|------|
| 40004 | è¿åŠ¨åˆ†ç±»ä¸å­˜åœ¨ | categoryCodeä¸å­˜åœ¨æˆ–å·²ç¦ç”¨ |
| 40101 | Tokenæ— æ•ˆæˆ–è¿‡æœŸ | æœªç™»å½•æˆ–Tokenå¤±æ•ˆ |
| 40901 | å‘å¸–è¿‡äºé¢‘ç¹ | 1åˆ†é’Ÿå†…å·²å‘å¸ƒ3æ¡å¸–å­ |
| 50001 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æ•°æ®åº“æ’å…¥å¤±è´¥ |

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### å‰ç½®æ¡ä»¶

1. **å¯åŠ¨é¡¹ç›®**:
   ```bash
   cd e:\unisport-backend
   mvn spring-boot:run
   ```

2. **è·å–JWT Token**:
   - å…ˆè°ƒç”¨ç™»å½•æ¥å£ `POST /api/auth/login` è·å–token
   - æˆ–ä½¿ç”¨å·²æœ‰çš„æµ‹è¯•ç”¨æˆ·token

3. **ç¡®è®¤è¿åŠ¨åˆ†ç±»å·²å­˜åœ¨**:
   - è°ƒç”¨ `GET /api/categories` æŸ¥çœ‹å¯ç”¨åˆ†ç±»
   - é»˜è®¤åˆ†ç±»ï¼šfootballã€basketballã€badmintonã€pingpongã€fitness

### æµ‹è¯•ç”¨ä¾‹

#### ç”¨ä¾‹1ï¼šæ­£å¸¸å‘å¸ƒå¸–å­ï¼ˆä»…æ–‡å­—ï¼‰

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/posts \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "categoryCode": "football",
    "content": "ä»Šå¤©çš„æ¯”èµ›å¤ªç²¾å½©äº†ï¼è®¡ç®—æœºç³»2:1æˆ˜èƒœç»ç®¡å­¦é™¢"
  }'
```

**é¢„æœŸç»“æœ**: è¿”å›å¸–å­å®ä½“ï¼Œimagesä¸ºnull

---

#### ç”¨ä¾‹2ï¼šå‘å¸ƒå¸¦å›¾ç‰‡çš„å¸–å­

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/posts \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "categoryCode": "basketball",
    "content": "ç¯®çƒèµ›ç°åœºæ°”æ°›è¶…çº§å¥½ï¼",
    "images": [
      "https://example.com/photo1.jpg",
      "https://example.com/photo2.jpg"
    ]
  }'
```

**é¢„æœŸç»“æœ**: è¿”å›å¸–å­å®ä½“ï¼Œimageså­—æ®µåŒ…å«JSONæ•°ç»„

---

#### ç”¨ä¾‹3ï¼šå‚æ•°æ ¡éªŒ - å†…å®¹ä¸ºç©º

**è¯·æ±‚**:
```json
{
  "categoryCode": "football",
  "content": ""
}
```

**é¢„æœŸç»“æœ**: 400é”™è¯¯ï¼Œæç¤º"å¸–å­å†…å®¹ä¸èƒ½ä¸ºç©º"

---

#### ç”¨ä¾‹4ï¼šå‚æ•°æ ¡éªŒ - åˆ†ç±»ä¸å­˜åœ¨

**è¯·æ±‚**:
```json
{
  "categoryCode": "invalid_category",
  "content": "æµ‹è¯•å†…å®¹"
}
```

**é¢„æœŸç»“æœ**: 40004é”™è¯¯ï¼Œæç¤º"è¿åŠ¨åˆ†ç±»ä¸å­˜åœ¨"

---

#### ç”¨ä¾‹5ï¼šé¢‘ç‡é™åˆ¶æµ‹è¯•

**æ“ä½œ**: åœ¨1åˆ†é’Ÿå†…è¿ç»­å‘å¸ƒ4æ¡å¸–å­

**é¢„æœŸç»“æœ**: å‰3æ¡æˆåŠŸï¼Œç¬¬4æ¡è¿”å›40901é”™è¯¯ï¼Œæç¤º"å‘å¸–è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"

---

#### ç”¨ä¾‹6ï¼šæœªç™»å½•è®¿é—®

**è¯·æ±‚**: ä¸æºå¸¦Authorization header

**é¢„æœŸç»“æœ**: 401é”™è¯¯ï¼Œæç¤º"Tokenæ— æ•ˆæˆ–è¿‡æœŸ"

---

## ğŸ“Š æ•°æ®åº“éªŒè¯

å‘å¸ƒæˆåŠŸåï¼Œæ£€æŸ¥æ•°æ®åº“ï¼š

```sql
-- æŸ¥çœ‹æœ€æ–°å‘å¸ƒçš„å¸–å­
SELECT * FROM posts ORDER BY created_at DESC LIMIT 5;

-- éªŒè¯å­—æ®µå€¼
SELECT 
    id,
    user_id,
    category_id,
    content,
    images,
    likes_count,
    comments_count,
    created_at
FROM posts 
WHERE id = <æ–°å¸–å­ID>;
```

---

## ğŸ¯ Knife4jæ–‡æ¡£

è®¿é—® Swagger UI æ–‡æ¡£ï¼š
```
http://localhost:8080/doc.html
```

åœ¨ã€Œå¸–å­ç®¡ç†ã€æ¨¡å—ä¸‹å¯ä»¥æ‰¾åˆ°ã€Œå‘å¸ƒå¸–å­ã€æ¥å£ï¼Œæ”¯æŒåœ¨çº¿æµ‹è¯•ã€‚

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. âœ… **æ‰€æœ‰ä»£ç å·²æ·»åŠ å®Œæ•´æ³¨é‡Š**ï¼ˆç±»ã€æ–¹æ³•ã€å‚æ•°ï¼‰
2. âœ… **éµå¾ªé¡¹ç›®åˆ†å±‚æ¶æ„**ï¼ˆController â†’ Service â†’ Mapperï¼‰
3. âœ… **ä½¿ç”¨äº†ThreadLocalè·å–å½“å‰ç”¨æˆ·**ï¼ˆUserContext.getCurrentUserId()ï¼‰
4. âœ… **å›¾ç‰‡å­˜å‚¨æ ¼å¼ä¸ºJSONå­—ç¬¦ä¸²**ï¼ˆé€šè¿‡hutoolçš„JSONUtilè½¬æ¢ï¼‰
5. âœ… **ä½¿ç”¨MyBatis Plusè‡ªåŠ¨å¡«å……**ï¼ˆcreatedAtã€updatedAtï¼‰
6. âœ… **ä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§**ï¼ˆ@Transactionalï¼‰
7. âœ… **å®Œæ•´çš„å‚æ•°æ ¡éªŒ**ï¼ˆä½¿ç”¨jakarta.validationï¼‰

---

## ğŸ”— ç›¸å…³æ–‡ä»¶è·¯å¾„

- **DTO**: `src/main/java/com/unisport/dto/CreatePostDTO.java`
- **Entity**: `src/main/java/com/unisport/entity/Post.java`
- **Mapper**: `src/main/java/com/unisport/mapper/PostMapper.java`
- **Service**: `src/main/java/com/unisport/service/PostService.java`
- **ServiceImpl**: `src/main/java/com/unisport/service/impl/PostServiceImpl.java`
- **Controller**: `src/main/java/com/unisport/controller/PostController.java`
- **æ•°æ®åº“è„šæœ¬**: `src/main/resources/sql/init.sql` (postsè¡¨å·²å­˜åœ¨)

---

## âœ¨ åç»­æ‰©å±•å»ºè®®

1. **å¸–å­åˆ—è¡¨æŸ¥è¯¢** - å®ç°åˆ†é¡µæŸ¥è¯¢ã€åˆ†ç±»ç­›é€‰
2. **å¸–å­è¯¦æƒ…** - è·å–å•ä¸ªå¸–å­å®Œæ•´ä¿¡æ¯ï¼ˆåŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼‰
3. **ç‚¹èµåŠŸèƒ½** - å®ç°ç‚¹èµ/å–æ¶ˆç‚¹èµ
4. **è¯„è®ºåŠŸèƒ½** - å®ç°è¯„è®ºã€å›å¤è¯„è®º
5. **åˆ é™¤å¸–å­** - å®ç°é€»è¾‘åˆ é™¤
6. **å›¾ç‰‡ä¸Šä¼ ** - å®ç°æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼ˆé˜¿é‡Œäº‘OSSï¼‰

---

**å¼€å‘å®Œæˆ** âœ…  
**ç¼–è¯‘é€šè¿‡** âœ…  
**ä»£ç å®¡æŸ¥** âœ…
